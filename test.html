<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Test d'éligibilité | ORACLE IMPÔT</title>
  <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&display=swap" rel="stylesheet">

  <style>
    :root{
      --primary:#0f172a;
      --accent:#2563eb;
      --accent-gradient: linear-gradient(135deg, #2563eb 0%, #3b82f6 100%);
      --text:#1e293b;
      --muted:#64748b;
      --soft:#f8fafc;
      --border:#e2e8f0;
      --shadow-md: 0 24px 60px rgba(15,23,42,.08);
    }

    *{ box-sizing:border-box; }
    body{
      margin:0;
      font-family:"Plus Jakarta Sans", sans-serif;
      background:var(--soft);
      color:var(--text);
      -webkit-font-smoothing:antialiased;
    }

    .container{ max-width:1100px; margin:0 auto; padding:0 20px; }

    header{
      height:72px;
      background:#fff;
      border-bottom:1px solid var(--border);
      display:flex;
      align-items:center;
    }
    .logo{ display:flex; align-items:center; gap:10px; text-decoration:none; font-weight:800; color:var(--primary); }
    .mark{ width:30px; height:30px; border-radius:8px; background:var(--accent-gradient); }
    .logo span{ color:var(--accent); }

    main{ min-height: calc(100vh - 72px); padding: 40px 0; display:flex; flex-direction:column; align-items:center; justify-content:center; }
    .test-wrapper{ max-width:550px; width:100%; }

    /* Barre de progression */
    .progress-container { margin-bottom: 24px; text-align: center; }
    .progress-bar-outer { height: 8px; background: #e2e8f0; border-radius: 10px; overflow: hidden; margin-bottom: 8px; }
    .progress-bar { height: 100%; background: var(--accent-gradient); width: 0%; transition: width 0.4s ease; }
    .progress-text { font-size: 14px; font-weight: 700; color: var(--accent); }

    /* Carte Question */
    .question-card {
      background: #fff;
      border-radius: 24px;
      padding: 32px;
      box-shadow: var(--shadow-md);
      border: 1px solid var(--border);
      min-height: 300px;
    }

    .question-title { font-size: 22px; font-weight: 800; color: var(--primary); margin-bottom: 24px; line-height: 1.3; }
    
    .choices { display: flex; flex-direction: column; gap: 10px; margin-bottom: 20px; }
    .choice-btn {
      padding: 16px 20px;
      border: 2px solid var(--border);
      border-radius: 14px;
      background: #fff;
      font-weight: 600;
      cursor: pointer;
      transition: 0.2s;
      text-align: left;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .choice-btn:hover { border-color: var(--accent); background: #f0f7ff; }
    .choice-btn.selected { border-color: var(--accent); background: #f0f7ff; }

    input[type="text"], input[type="number"], input[type="email"], input[type="tel"] {
      width: 100%; padding: 16px; border: 2px solid var(--border); border-radius: 12px; font-size: 16px; margin-bottom: 16px; outline: none;
    }
    input:focus { border-color: var(--accent); }

    .btn-primary {
      width: 100%; padding: 16px; border-radius: 12px; border: none;
      background: var(--accent-gradient); color: #fff; font-weight: 800; font-size: 16px;
      cursor: pointer; box-shadow: 0 10px 20px rgba(37,99,235,0.2);
    }
    .btn-primary:disabled { opacity: 0.3; cursor: not-allowed; }

    .rgpd { font-size: 12px; color: var(--muted); margin-top: 15px; display: flex; gap: 10px; }
  </style>
</head>
<body>

<header>
  <div class="container">
    <a href="index.html" class="logo">
      <div class="mark"></div>
      ORACLE <span>IMPÔT</span>
    </a>
  </div>
</header>

<main>
  <div class="test-wrapper">
    <div class="progress-container">
      <div class="progress-bar-outer"><div class="progress-bar" id="progressBar"></div></div>
      <div class="progress-text" id="progressText">Chargement...</div>
    </div>

    <div class="question-card" id="questionContainer">
      <!-- JS injectera les questions ici -->
    </div>
  </div>
</main>

<script>
  const questions = [
    { id: 'situation', title: 'Quelle est votre situation ?', type: 'choice', choices: ['Salarié', 'Indépendant', 'Chef d\'entreprise', 'Retraité', 'Étudiant', 'Sans activité'] },
    { id: 'age', title: 'Quel âge avez-vous ?', type: 'input', inputType: 'number', placeholder: 'Ex: 35' },
    { id: 'enfants', title: 'Combien d\'enfants à charge avez-vous ?', type: 'choice', choices: ['0', '1', '2', '3', '4 ou plus'] },
    { id: 'logement', title: 'Comment logez-vous ?', type: 'choice', choices: ['Propriétaire', 'Locataire', 'Logé gratuitement'] },
    { id: 'activite', title: 'Quelle est votre activité ?', type: 'input', inputType: 'text', placeholder: 'Ex: Ingénieur, Commercial...' },
    { id: 'revenus', title: 'Quels sont vos revenus nets MENSUELS ?', type: 'input', inputType: 'number', placeholder: 'Ex: 3000' },
    { id: 'contact', title: 'Votre résultat est prêt', type: 'contact' }
  ];

  let currentStep = 0;
  let answers = {};

  function render() {
    const container = document.getElementById('questionContainer');
    const q = questions[currentStep];
    
    // Update Progress
    const pct = ((currentStep + 1) / questions.length) * 100;
    document.getElementById('progressBar').style.width = pct + '%';
    document.getElementById('progressText').innerText = `Question ${currentStep + 1} sur ${questions.length}`;

    let html = `<div class="question-title">${q.title}</div>`;

    if (q.type === 'choice') {
      html += `<div class="choices">`;
      q.choices.forEach(c => {
        html += `<button class="choice-btn" onclick="selectChoice('${c}')">${c}</button>`;
      });
      html += `</div>`;
    } 
    else if (q.type === 'input') {
      html += `<input type="${q.inputType}" id="valInput" placeholder="${q.placeholder}" oninput="validateInput()">`;
      html += `<button class="btn-primary" id="nextBtn" onclick="next()" disabled>Suivant</button>`;
    } 
    else if (q.type === 'contact') {
      html += `
        <input type="text" id="nom" placeholder="Nom et Prénom" oninput="validateContact()">
        <input type="email" id="email" placeholder="Email" oninput="validateContact()">
        <input type="tel" id="tel" placeholder="Téléphone" oninput="validateContact()">
        <div class="rgpd">
          <input type="checkbox" id="rgpd" onchange="validateContact()">
          <span>J'accepte d'être recontacté par Oracle Impôt.</span>
        </div>
        <button class="btn-primary" id="submitBtn" onclick="send()" disabled style="margin-top:20px">Recevoir mon analyse</button>
      `;
    }
    container.innerHTML = html;
  }

  window.selectChoice = (val) => {
    answers[questions[currentStep].id] = val;
    if(currentStep === 0 && val === 'Étudiant') {
        alert("Désolé, ce test s'adresse aux actifs et retraités.");
        window.location.href = "index.html";
        return;
    }
    next();
  };

  window.validateInput = () => {
    const val = document.getElementById('valInput').value;
    document.getElementById('nextBtn').disabled = val.length < 1;
    answers[questions[currentStep].id] = val;
  };

  window.validateContact = () => {
    const n = document.getElementById('nom').value;
    const e = document.getElementById('email').value;
    const t = document.getElementById('tel').value;
    const r = document.getElementById('rgpd').checked;
    document.getElementById('submitBtn').disabled = !(n && e && t && r);
  };

  window.next = () => {
    currentStep++;
    render();
  };

  window.send = () => {
    const btn = document.getElementById('submitBtn');
    btn.innerText = "Envoi en cours...";
    btn.disabled = true;

    const msg = `Nouveau Lead Oracle Impôt:
    Nom: ${document.getElementById('nom').value}
    Email: ${document.getElementById('email').value}
    Tel: ${document.getElementById('tel').value}
    Situation: ${answers.situation}
    Age: ${answers.age}
    Enfants: ${answers.enfants}
    Logement: ${answers.logement}
    Activite: ${answers.activite}
    Revenus: ${answers.revenus}€/mois`;

    const formData = new FormData();
    formData.append('email', document.getElementById('email').value);
    formData.append('message', msg);

    fetch('https://formspree.io/f/xeezykeq', {
      method: 'POST',
      body: formData,
      headers: { 'Accept': 'application/json' }
    }).then(() => {
      document.getElementById('questionContainer').innerHTML = `
        <div style="text-align:center; padding:40px 0;">
          <h2 style="color:var(--accent)">Félicitations !</h2>
          <p>Votre demande a été transmise. Un conseiller Oracle Impôt vous contactera sous 24h.</p>
          <a href="index.html" style="color:var(--accent); font-weight:bold; text-decoration:none;">Retour à l'accueil</a>
        </div>`;
    });
  };

  render();
</script>
</body>
</html>
